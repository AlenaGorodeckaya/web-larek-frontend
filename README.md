# **Проектная работа "Веб-ларек"**
Web-ларёк — интернет-магазина с товарами для веб-разработчиков. В данном интернет-магазине можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

## Ссылки
[Макет Figma](https://www.figma.com/design/0KMR7HxUUMyRPMjuCvQEN1/Веб-ларёк?node-id=0-1)

## Используемый стек
- TypeScript (TS)
- HTML
- SCSS
- Webpack

## Инструкция по сборке и запуску

1. Клонировать репозиторий:
```
git clone https://github.com/AlenaGorodeckaya/web-larek-frontend.git
```

2. После клонирования проекта установить зависимости:
```
npm install
```

3. Для запуска проекта в режиме разработки выполнить команду:
```
npm run start
```

4. Для сборки проекта в продакшен выполнить команду:
```
npm run build
```

## Архитектура проекта
Проект реализован с использованием паттерна MVP (Model-View-Presenter) c элементами EventEmitter для управления событиями.

### Основные слои архитектуры:
1. `Model` - отвечает за хранение данных и уведомляет об изменениях через события.

2. `View` - отвечает за отображение данных и взаимодействие с пользователем.

3. `Presenter` - связывает Model и View, обрабатывает логику, взаимодействует с API.

Взаимодействие между слоями организовано через систему событий `EventEmitter`.

## Описание базовых классов
`EventEmitter` - базовый класс для реализации событий, который позволяет:
- `emit` - генерировать события;
- `off` - удалять обработчики событий;
- `on` - устанавливать обработчики событий.

`Component` - базовый класс для всех компонентов, 
реализует:
- шаблонизацию через HTML-темплейты;
- базовую логику рендеринга;
- абстрактный метод для настройки компонента.

`Api` - базовый класс для взаимодействия с сервером через API, обеспечивающий отправку HTTP-запросов и обработку ответов сервера, реализует:
- отправку запросов (GET, POST и другие методы);
- обработку ответов (парсинг JSON, проверку статусов);
- расширяемую логику (можно добавить авторизацию, повторы запросов).

## Model (Модели данных)
Это абстрактный базовый класс, предназначенный для создания моделей данных.  Когда ее состояние меняется (например, обновляются данные, добавляются новые поля и др.), модель инициирует событие, чтобы другие части системы могли отреагировать. Модели не взаимодействуют с сервером напрямую. Данные загружаются через `AppPresenter` и передаются в модели.

Принимает:
- `data` - частичные данные модели (объект типа Partial<T>)
- `events` - экземпляр системы событий (интерфейс IEvents)

```
emitChanges(event: string, payload?: object): void; // Уведомляет об изменениях в модели
```
### `ProductModel` 
Отвечает за хранение данных товаров и логику работы с ними. Принимает:
- events - экземпляр EventEmitter для инициации событий.

Поля класса:
```
- private _products: IProduct[] = []; // Массив товаров
- private _preview: string | null = null; // ID товара для превью
```
Геттеры:
```
- get products(): Product[] // Возвращает текущий список продуктов
- get preview(): string | null // Возвращает ID продукта в preview
```

Основные методы класса:

`setProducts(products: IProduct[]): void`
- принимает готовые данные (загруженные через `AppPresenter`);  
- обновляет массив `_products`;  
- генерирует событие `items:changed`.

`setPreview(product: IProduct): void`
- устанавливает продукт для предпросмотра;
- генерирует событие `preview:changed`.

### `CartModel` 
Отвечает за управление данными корзины покупочек.
Принимает:
- events - экземпляр EventEmitter для инициации событий

Поля класса:
```
- private _items: IProduct[] = []; // Товары в корзине (каждый товар в одном экземпляре)`
- private _total: number = 0; // Общая стоимость
- private _quantity: number = 0; // Количество товаров
```
Геттеры:
```
- get items(): IProduct[] // Возвращает массив товаров
- get total(): number // Возвращает общую стоимость
- get quantity(): number // Возвращает количество товаров
```
**Примечание**: Хотя CartModel хранит полные объекты товаров (IProduct[]), 
CartItemView использует упрощенный интерфейс CartItem (только title и price) 
для отображения элементов корзины.

Основные методы класса:

`addItem(item: IProduct): void`
- проверяет наличие товара в корзине (по `id`);
- если товар отсутствует — добавляет его в массив `_items`;
- пересчитывает итоги;
- генерирует событие `cart:changed`.

`removeItem(productId: string): void`
- удаляет товар из корзины;
- пересчитывает итоги;
- генерирует событие `cart:changed`.

`clearCart(): void`
- полностью очищает корзину;
- генерирует событие `cart:changed`.

`isItemInCart(item: IProduct): boolean`
- проверяет наличие товара в корзине по ID;
- возвращает true если товар найден.

`calculateTotals(): void`
- пересчитывает общую стоимость и количество;
- вызывается автоматически при изменении корзины.


### `OrderModel` 

Отвечает за управление данными заказа.Обрабатывает валидацию и отправку заказа на сервер.

Принимает:
- events - экземпляр EventEmitter для инициации событий

Поля класса:
```
private _order: OrderData = {
payment: '',
email: '',
phone: '',
address: '',
items: [],
total: 0
};
private _errors: FormErrors = {};
```
Геттеры:
```
- get data(): OrderData // Возвращает текущие данные заказа
- get errors(): FormErrors // Возвращает ошибки валидации
```

Основные методы класса:

``setField(field: keyof OrderData, value: string): void`
- устанавливает значение поля заказа;
- автоматически запускает валидацию;
- генерирует событие `order:changed`.

`validateDelivery(): boolean`
- проверяет корректность данных доставки (адрес и способ оплаты);
- заполняет объект ошибок;
- возвращает true если данные валидны.

`validateContacts(): boolean`
- проверяет корректность контактных данных (email и телефон);
- заполняет объект ошибок;
- возвращает true если данные валидны.

`clear(): void`
- сбрасывает все данные заказа;
- генерирует событие `order:cleared`.

`setItems(items: string[]): void`
- устанавливает список ID товаров в заказе.

## View 
Представления только отображают данные и взаимодействуют с пользователем. Данные хранятся в моделях.

### `ProductCard`
Отображает карточку товара с возможностью добавления в корзину.

Наследование: Component<Product>

Конструктор:
```
constructor(protected blockName: string, container: HTMLElement, action?: ICardAction)
```
Основные свойства:
- `buttonText` - устанавливает текст кнопки
- `category` - устанавливает категорию товара с соответствующим стилем
- `price` - устанавливает цену товара ("Бесценно" если null)

### `Modal`
Управляет отображением и поведением модальных окон в приложении.

Наследование: Component<IModalData>
Конструктор:
```
constructor(container: HTMLElement, events: IEvents)
```
Методы:
- `open()` - открыть модальное окно;
- `close()` - закрыть модальное окно;
- `set content` - установить содержимое модального окна.

### `CartItemView`
Отображает один элемент корзины. Создается при каждом изменении корзины.

Наследование: Component<CartItem>

Конструктор:
```
constructor(container: HTMLElement, index: number, action?: ICardAction)
```
Свойства:
- `title` - устанавливает название товара
- `price` - устанавливает цену товара
- `index` - устанавливает порядковый номер

### `CartView`
Управляет отображением корзины покупочек.

Наследование: Component<ICartView>

Конструктор:
```
constructor(container: HTMLElement, events: EventEmitter)
```
ММетоды:
- `set items` - обновляет список товаров в корзине
- `set total` - устанавливает общую сумму заказа
- `toggleButton` - управляет состоянием кнопки оформления заказа

### `OrderForm`
#### `OrderAddress`
Управляет формой ввода данных доставки.

Наследование: Form<OrderDeliveryFormData>

Конструктор:
constructor(container: HTMLFormElement, events: EventEmitter)

Методы:
- `selectPaymentMethod` - выделяет выбранный способ оплаты
- `set valid` - управляет состоянием кнопки "Далее"
- `set errors` - отображает ошибки валидации

#### `OrderContacts`
Управляет формой ввода контактных данных.

Наследование: Form<OrderContactFormData>

Конструктор:
constructor(container: HTMLFormElement, events: EventEmitter, orderModel: OrderModel)

Методы:
- `set valid` - управляет состоянием кнопки "Оплатить"
- `set errors` - отображает ошибки валидации

### `SuccessView`
Управляет отображением сообщения об успешном заказе.

Наследование: Component<ISuccessModal>

Конструктор:
```
constructor(container: HTMLElement, actions: ISuccessModalActions)
```
Методы:
- `set total` - устанавливает сумму заказа

### `PageView`
Управляет основными элементами страницы.

Наследование: Component<IPage>

Конструктор:
```
constructor(container: HTMLElement, events: EventEmitter)
```
Методы:
- `set counter` - обновляет счетчик товаров в корзине
- `set catalog` - обновляет каталог товаров
- `set locked` - блокирует/разблокирует страницу

## Presenter 
### `AppPresenter`
Координирует работу моделей и представлений:
- обрабатывает события от представлений;
- взаимодействует с API (отправляет запросы, получает данные);
- обновляет модели данных полученными с сервера данными;
- управляет состоянием приложения.

## Типы данных
Все типы и интерфейсы вынесены в отдельный файл `src/types/index.ts`

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Взаимодействие компонентов
Взаимодействие между компонентами организовано через систему событий с использованием EventEmitter.

**События изменения данных (генерируются моделями):**

`products:changed` - изменение списка товаров.
- Генерируется: ProductData при загрузке или изменении списка товаров.
- Обработчик: обновляет PageView и перерисовывает каталог.

`preview:changed` - изменение товара для предпросмотра.
- Генерируется: ProductData при выборе товара.
- Обработчик: открывает Modal с деталями товара.

`cart:changed` - изменение содержимого корзины.
- Генерируется: CartData при любом изменении корзины.
- Обработчик: создает новые CartItemView, обновляет CartView и счетчик в PageView.

`order:changed` - изменение данных заказа.
- Генерируется: OrderData при изменении полей формы.
- Обработчик: OrderForm отправляет данные в OrderModel через setField().

`counter:changed` - изменение количества товаров в корзине.
- Генерируется: CartModel при обновлении корзины.
- Обработчик: обновляет счетчик в PageView.

**События пользовательского интерфейса:**

`card:select` - выбор карточки товара.
- Генерируется: ProductCard при клике.
- Обработчик: вызывает ProductData.setPreview().

`cart:open` - открытие корзины.
- Генерируется: PageView при клике на иконку корзины.
- Обработчик: открывает CartView в Modal.

`order:open` - открытие формы заказа.
- Генерируется: CartView при клике "Оформить".
- Обработчик: открывает OrderAddress в Modal.

`order:submit` - отправка формы доставки.
- Генерируется: OrderAddress при успешной валидации.
- Обработчик: открывает OrderContacts в Modal.

`contacts:submit` - отправка контактных данных.
- Генерируется: OrderContacts при успешной валидации.
- Обработчик: отправляет заказ на сервер, открывает SuccessView.

`modal:open/close` - открытие/закрытие модального окна.
- Генерируется: Modal.
- Обработчик: блокирует/разблокирует страницу.

**Последовательность событий при оформлении заказа:**
1. Пользователь нажимает "Оформить заказ" в `CartView` → генерируется order:open.
2. Открывается `Modal` с `OrderAddress`.
3. Пользователь заполняет форму → генерируются события `order.payment:change` и `order.address:change`.
4. При изменении поля вызывается `OrderModel.setField()`.
5. OrderModel валидирует данные через `validateDelivery()`.
6. При успешной валидации активируется кнопка "Далее".
7. Пользователь нажимает "Далее" → генерируется `order:submit`.
8. Открывается `OrderContacts`.
9. Пользователь заполняет контакты → генерируются `contacts.phone:change` и `contacts.email:change`.
10. OrderModel валидирует данные через `validateContacts()`.
11. При успешной валидации активируется кнопка "Оплатить".
12. Пользователь нажимает "Оплатить" → генерируется `contacts:submit`.
13. AppPresenter отправляет данные на сервер через API.
14. При успехе открывается `SuccessView`.
15. Корзина очищается через `CartModel.clearCart()`.